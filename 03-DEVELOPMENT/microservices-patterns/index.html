
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://nitinkc.github.io/BitVelocity-Docs/03-DEVELOPMENT/microservices-patterns/">
      
      
        <link rel="prev" href="../../01-ARCHITECTURE/CROSS_DATA_PLATFORM_AND_ANALYTICS/">
      
      
        <link rel="next" href="../api-protocols/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Microservices Patterns - BitVelocity Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#microservices-patterns-implementation-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="BitVelocity Wiki" class="md-header__button md-logo" aria-label="BitVelocity Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BitVelocity Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Microservices Patterns
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../00-OVERVIEW/projects-and-modules/" class="md-tabs__link">
          
  
  
  Overview

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../01-ARCHITECTURE/system-overview/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Development

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../02-INFRASTRUCTURE/cloud-strategy/" class="md-tabs__link">
          
  
  
  Infrastructure

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../stories/QUICK-START/" class="md-tabs__link">
          
  
  
  Stories & Phases

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../05-PROJECT-MANAGEMENT/sprint-planning/" class="md-tabs__link">
          
  
  
  Project Management

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../adr/ADR-001-multi-repo-vs-monorepo/" class="md-tabs__link">
          
  
  
  ADRs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BitVelocity Wiki" class="md-nav__button md-logo" aria-label="BitVelocity Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    BitVelocity Wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00-OVERVIEW/projects-and-modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Projects & Modules
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00-OVERVIEW/stakeholder-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stakeholder Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00-OVERVIEW/project-charter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Project Charter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/system-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/data-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/security-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Domains
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Domains
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/domains/ecommerce/DOMAIN_ECOMMERCE_ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    E-Commerce
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/domains/chat/DOMAIN_CHAT_ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Chat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/domains/iot/DOMAIN_IOT_ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    IoT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/domains/social/DOMAIN_SOCIAL_ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Social
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/domains/ml-ai/DOMAIN_ML_AI_ARCHITECTURE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ML/AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Cross-Cutting
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cross-Cutting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/CROSS_OBSERVABILITY_AND_TESTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Observability & Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/CROSS_EVENT_CONTRACTS_AND_VERSIONING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Event Contracts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/CROSS_REPLAY_DR_DRILLS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Replay & DR
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/CROSS_COST_OPTIMIZATION/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cost Optimization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-ARCHITECTURE/CROSS_DATA_PLATFORM_AND_ANALYTICS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Platform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Microservices Patterns
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Microservices Patterns
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-introduction-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern Introduction Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern Introduction Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#learning-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Learning Sequence
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-microservices-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Microservices Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Microservices Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-service-decomposition-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Service Decomposition Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Service Decomposition Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-per-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database per Service
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shared-libraries-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shared Libraries Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-communication-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Communication Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Communication Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-gateway-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Gateway Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-discovery-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service Discovery Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-data-management-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Data Management Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Data Management Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-query-responsibility-segregation-cqrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Command Query Responsibility Segregation (CQRS)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-sourcing-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Event Sourcing Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saga-pattern-orchestration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Saga Pattern (Orchestration)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-integration-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Integration Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Integration Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend-for-frontend-bff" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backend for Frontend (BFF)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-corruption-layer-acl" class="md-nav__link">
    <span class="md-ellipsis">
      
        Anti-Corruption Layer (ACL)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strangler-fig-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Strangler Fig Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-resilience-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Resilience Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Resilience Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bulkhead-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bulkhead Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Timeout Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-pattern-with-backoff" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Pattern with Backoff
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-roadmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Roadmap
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Roadmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#week-1-2-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 1-2: Foundation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-3-4-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 3-4: Communication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-5-6-data-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 5-6: Data Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-7-8-advanced-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 7-8: Advanced Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-9-10-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 9-10: Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-11-12-resilience" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 11-12: Resilience
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-specific-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern-Specific Testing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring and Observability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-specific-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern-Specific Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-protocols/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Protocols
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing-strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Testing Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../performance-testing-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-INFRASTRUCTURE/cloud-strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cloud Strategy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-INFRASTRUCTURE/deployment-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Stories & Phases
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Stories & Phases
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/QUICK-START/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/REFERENCE-TOPICS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reference Topics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phases Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 0 - Groundwork
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 1 - Foundations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 2 - Contracts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 3 - Protocols
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 4 - Data & State
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 5 - Real-Time
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 6 - Resilience
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 7 - Integrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 8 - UAT
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stories/phases/PHASE-9/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Phase 9 - Hardening
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Project Management
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project Management
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-PROJECT-MANAGEMENT/sprint-planning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sprint Planning
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-PROJECT-MANAGEMENT/WEEKLY-CHECKLIST/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weekly Checklist
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-PROJECT-MANAGEMENT/IMPLEMENTATION-ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-PROJECT-MANAGEMENT/budget-planning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Budget
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    ADRs
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    ADRs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-001-multi-repo-vs-monorepo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-001 Multi-repo vs Monorepo
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-002-event-vs-cdc-strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-002 Event vs CDC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-003-protocol-introduction-order/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-003 Protocol Order
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-004-oltp-cdc-olap-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-004 OLTP CDC OLAP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-005-security-layering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-005 Security
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-006-retry-backoff-policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-006 Retry Policies
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-007-observability-baseline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-007 Observability
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-008-pulumi-cloud-provider-abstraction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-008 Pulumi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-015-load-testing-strategy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-015 Load Testing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-016-chaos-engineering-framework/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-016 Chaos Engineering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../adr/ADR-017-cicd-pipeline-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ADR-017 CI/CD Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#purpose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Purpose
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pattern-introduction-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern Introduction Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pattern Introduction Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#learning-sequence" class="md-nav__link">
    <span class="md-ellipsis">
      
        Learning Sequence
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-microservices-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Microservices Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Microservices Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-service-decomposition-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Service Decomposition Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Service Decomposition Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-per-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Database per Service
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shared-libraries-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Shared Libraries Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-communication-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Communication Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Communication Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-gateway-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Gateway Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#service-discovery-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Service Discovery Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#circuit-breaker-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Circuit Breaker Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-data-management-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Data Management Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Data Management Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-query-responsibility-segregation-cqrs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Command Query Responsibility Segregation (CQRS)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#event-sourcing-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Event Sourcing Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#saga-pattern-orchestration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Saga Pattern (Orchestration)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-integration-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Integration Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Integration Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#backend-for-frontend-bff" class="md-nav__link">
    <span class="md-ellipsis">
      
        Backend for Frontend (BFF)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anti-corruption-layer-acl" class="md-nav__link">
    <span class="md-ellipsis">
      
        Anti-Corruption Layer (ACL)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strangler-fig-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Strangler Fig Pattern
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-resilience-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Resilience Patterns
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Resilience Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bulkhead-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bulkhead Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#timeout-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        Timeout Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retry-pattern-with-backoff" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retry Pattern with Backoff
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-roadmap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Roadmap
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Roadmap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#week-1-2-foundation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 1-2: Foundation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-3-4-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 3-4: Communication
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-5-6-data-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 5-6: Data Patterns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-7-8-advanced-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 7-8: Advanced Data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-9-10-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 9-10: Integration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#week-11-12-resilience" class="md-nav__link">
    <span class="md-ellipsis">
      
        Week 11-12: Resilience
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Testing Strategy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-specific-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern-Specific Testing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-and-observability" class="md-nav__link">
    <span class="md-ellipsis">
      
        Monitoring and Observability
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Monitoring and Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pattern-specific-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pattern-Specific Metrics
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="microservices-patterns-implementation-guide">Microservices Patterns &amp; Implementation Guide</h1>
<h2 id="purpose">Purpose</h2>
<p>This document provides comprehensive guidance on microservices patterns, their implementation in the BitVelocity platform, and the sequence for introducing complexity during the learning process.</p>
<h2 id="pattern-introduction-strategy">Pattern Introduction Strategy</h2>
<h3 id="learning-sequence">Learning Sequence</h3>
<ol>
<li><strong>Foundation Patterns</strong> (Weeks 1-4): Basic CRUD, Authentication, Events</li>
<li><strong>Communication Patterns</strong> (Weeks 5-8): API Gateway, Service Discovery, Circuit Breaker</li>
<li><strong>Data Patterns</strong> (Weeks 9-12): CQRS, Event Sourcing, Saga</li>
<li><strong>Advanced Integration</strong> (Weeks 13-16): BFF, Anti-Corruption Layer, Strangler Fig</li>
<li><strong>Operational Patterns</strong> (Weeks 17-20): Bulkhead, Timeout, Retry, Rate Limiting</li>
</ol>
<h2 id="core-microservices-patterns">Core Microservices Patterns</h2>
<h3 id="1-service-decomposition-patterns">1. Service Decomposition Patterns</h3>
<h4 id="database-per-service">Database per Service</h4>
<p><strong>Intent</strong>: Each microservice owns its data and database schema.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Order Service - owns order data</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;orders&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Order</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span><span class="w"> </span><span class="c1">// Reference, not FK</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Audit fields</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">createdBy</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Customer Service - owns customer data  </span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;customers&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Customer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">email</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CustomerStatus</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Implementation Strategy</strong>:</p>
<ul>
<li>Start with logical separation in same database</li>
<li>Migrate to physical separation as services stabilize</li>
<li>Use shared libraries for common patterns</li>
</ul>
<h4 id="shared-libraries-pattern">Shared Libraries Pattern</h4>
<p><strong>Intent</strong>: Share common code while maintaining service autonomy.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Shared event library</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">eventId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">();</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">eventType</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">correlationId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">metadata</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Usage in Order Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderCreatedEvent</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DomainEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">OrderCreatedEvent</span><span class="p">(</span><span class="n">UUID</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">customerId</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="s">&quot;OrderCreated&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">MDC</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;correlationId&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">getEventMetadata</span><span class="p">());</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">customerId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-communication-patterns">2. Communication Patterns</h3>
<h4 id="api-gateway-pattern">API Gateway Pattern</h4>
<p><strong>Intent</strong>: Single entry point for all client requests with cross-cutting concerns.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/api/gateway&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApiGatewayController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ServiceRegistry</span><span class="w"> </span><span class="n">serviceRegistry</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LoadBalancer</span><span class="w"> </span><span class="n">loadBalancer</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@PostMapping</span><span class="p">(</span><span class="s">&quot;/orders&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">OrderResponse</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">createOrder</span><span class="p">(</span>
<span class="w">            </span><span class="nd">@RequestBody</span><span class="w"> </span><span class="n">CreateOrderRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span>
<span class="w">            </span><span class="nd">@RequestHeader</span><span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">)</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">authToken</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// Authentication &amp; Authorization</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">authService</span><span class="p">.</span><span class="na">validateToken</span><span class="p">(</span><span class="n">authToken</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Rate limiting</span>
<span class="w">        </span><span class="n">rateLimiter</span><span class="p">.</span><span class="na">checkLimit</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Request routing</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">orderService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">serviceRegistry</span><span class="p">.</span><span class="na">getService</span><span class="p">(</span><span class="s">&quot;order-service&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">endpoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loadBalancer</span><span class="p">.</span><span class="na">selectEndpoint</span><span class="p">(</span><span class="n">orderService</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Request transformation</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">internalRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">requestTransformer</span><span class="p">.</span><span class="na">transform</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Circuit breaker protection</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">circuitBreaker</span><span class="p">.</span><span class="na">execute</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span>
<span class="w">            </span><span class="n">orderServiceClient</span><span class="p">.</span><span class="na">createOrder</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span><span class="w"> </span><span class="n">internalRequest</span><span class="p">)</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="service-discovery-pattern">Service Discovery Pattern</h4>
<p><strong>Intent</strong>: Services register themselves and discover other services dynamically.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ServiceRegistry</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ServiceInstance</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">services</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="nd">@EventListener</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleServiceRegistration</span><span class="p">(</span><span class="n">ServiceRegistrationEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">services</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getServiceName</span><span class="p">(),</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getServiceInstance</span><span class="p">());</span>

<span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Service registered: {} at {}&quot;</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">getServiceName</span><span class="p">(),</span><span class="w"> </span>
<span class="w">                </span><span class="n">event</span><span class="p">.</span><span class="na">getServiceInstance</span><span class="p">().</span><span class="na">getEndpoint</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ServiceInstance</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getHealthyInstances</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">serviceName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">services</span><span class="p">.</span><span class="na">getOrDefault</span><span class="p">(</span><span class="n">serviceName</span><span class="p">,</span><span class="w"> </span><span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">ServiceInstance</span><span class="p">::</span><span class="n">isHealthy</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Service registration on startup</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ServiceRegistrar</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ApplicationListener</span><span class="o">&lt;</span><span class="n">ContextRefreshedEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onApplicationEvent</span><span class="p">(</span><span class="n">ContextRefreshedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ServiceInstance</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">serviceId</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">serviceName</span><span class="p">(</span><span class="n">applicationProperties</span><span class="p">.</span><span class="na">getServiceName</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">endpoint</span><span class="p">(</span><span class="n">buildEndpoint</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">metadata</span><span class="p">(</span><span class="n">getServiceMetadata</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">healthCheckUrl</span><span class="p">(</span><span class="n">getHealthCheckUrl</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="n">serviceRegistry</span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="circuit-breaker-pattern">Circuit Breaker Pattern</h4>
<p><strong>Intent</strong>: Prevent cascading failures by failing fast when downstream services are unhealthy.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">CircuitBreaker</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">CircuitBreakerState</span><span class="o">&gt;</span><span class="w"> </span><span class="n">circuitStates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">circuitName</span><span class="p">,</span><span class="w"> </span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">fallback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">circuitStates</span><span class="p">.</span><span class="na">computeIfAbsent</span><span class="p">(</span><span class="n">circuitName</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CircuitBreakerState</span><span class="p">());</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">isOpen</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">shouldAttemptReset</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">state</span><span class="p">.</span><span class="na">halfOpen</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">fallback</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">operation</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<span class="w">            </span><span class="n">state</span><span class="p">.</span><span class="na">recordSuccess</span><span class="p">();</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">state</span><span class="p">.</span><span class="na">recordFailure</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="na">shouldTrip</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">state</span><span class="p">.</span><span class="na">open</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">fallback</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="nf">getOrderDetails</span><span class="p">(</span><span class="n">UUID</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">circuitBreaker</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;customer-service&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">customerServiceClient</span><span class="p">.</span><span class="na">getCustomer</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">()),</span>
<span class="w">            </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">CustomerSummary</span><span class="p">.</span><span class="na">unavailable</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">())</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3-data-management-patterns">3. Data Management Patterns</h3>
<h4 id="command-query-responsibility-segregation-cqrs">Command Query Responsibility Segregation (CQRS)</h4>
<p><strong>Intent</strong>: Separate read and write models for better scalability and maintainability.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Command side - optimized for writes</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;orders&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderAggregate</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">customerId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderStatus</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItem</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addItem</span><span class="p">(</span><span class="n">OrderItem</span><span class="w"> </span><span class="n">item</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">validateItem</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">items</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
<span class="w">        </span><span class="n">applyEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderItemAddedEvent</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">confirm</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">PENDING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InvalidOrderStateException</span><span class="p">(</span><span class="s">&quot;Order must be pending to confirm&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">CONFIRMED</span><span class="p">;</span>
<span class="w">        </span><span class="n">applyEvent</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">OrderConfirmedEvent</span><span class="p">(</span><span class="n">orderId</span><span class="p">,</span><span class="w"> </span><span class="n">Instant</span><span class="p">.</span><span class="na">now</span><span class="p">()));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Query side - optimized for reads</span>
<span class="nd">@Document</span><span class="p">(</span><span class="n">collection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;order_views&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderView</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">customerName</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">customerEmail</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">totalAmount</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">OrderItemView</span><span class="o">&gt;</span><span class="w"> </span><span class="n">items</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">lastUpdated</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Projection handler</span>
<span class="nd">@EventListener</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderViewProjectionHandler</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrderViewRepository</span><span class="w"> </span><span class="n">orderViewRepository</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@KafkaListener</span><span class="p">(</span><span class="n">topics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;order-events&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleOrderEvent</span><span class="p">(</span><span class="n">DomainEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getEventType</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;OrderCreated&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">handleOrderCreated</span><span class="p">((</span><span class="n">OrderCreatedEvent</span><span class="p">)</span><span class="w"> </span><span class="n">event</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;OrderConfirmed&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">handleOrderConfirmed</span><span class="p">((</span><span class="n">OrderConfirmedEvent</span><span class="p">)</span><span class="w"> </span><span class="n">event</span><span class="p">);</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;OrderItemAdded&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">handleOrderItemAdded</span><span class="p">((</span><span class="n">OrderItemAddedEvent</span><span class="p">)</span><span class="w"> </span><span class="n">event</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleOrderCreated</span><span class="p">(</span><span class="n">OrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">orderView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OrderView</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">orderId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getAggregateId</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">customerId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getCustomerId</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">totalAmount</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="s">&quot;PENDING&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">createdAt</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getTimestamp</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="n">orderViewRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">orderView</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="event-sourcing-pattern">Event Sourcing Pattern</h4>
<p><strong>Intent</strong>: Store domain events as the primary source of truth.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;event_store&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">EventStore</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Id</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">eventId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">aggregateType</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">eventType</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">eventData</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">timestamp</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">metadata</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Optimistic locking</span>
<span class="w">    </span><span class="nd">@Version</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">lockVersion</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@Repository</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">EventStoreRepository</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">saveEvents</span><span class="p">(</span><span class="n">UUID</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">expectedVersion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">currentVersion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getLatestVersion</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">currentVersion</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">expectedVersion</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ConcurrencyException</span><span class="p">(</span><span class="s">&quot;Aggregate has been modified&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">events</span><span class="p">.</span><span class="na">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">events</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">eventStoreEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EventStore</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">eventId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getEventId</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">aggregateId</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">aggregateType</span><span class="p">(</span><span class="n">getAggregateType</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">eventType</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getEventType</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">eventData</span><span class="p">(</span><span class="n">jsonMapper</span><span class="p">.</span><span class="na">writeValueAsString</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">version</span><span class="p">(</span><span class="n">expectedVersion</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">timestamp</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getTimestamp</span><span class="p">())</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">            </span><span class="n">eventStoreJpaRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">eventStoreEntry</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">DomainEvent</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getEvents</span><span class="p">(</span><span class="n">UUID</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">eventStoreJpaRepository</span><span class="p">.</span><span class="na">findByAggregateIdOrderByVersion</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">deserializeEvent</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Aggregate reconstruction</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AggregateRepository</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AggregateRoot</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="nf">getById</span><span class="p">(</span><span class="n">UUID</span><span class="w"> </span><span class="n">aggregateId</span><span class="p">,</span><span class="w"> </span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">aggregateClass</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">getEvents</span><span class="p">(</span><span class="n">aggregateId</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createEmptyAggregate</span><span class="p">(</span><span class="n">aggregateClass</span><span class="p">);</span>

<span class="w">        </span><span class="n">events</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">aggregate</span><span class="p">::</span><span class="n">applyEvent</span><span class="p">);</span>
<span class="w">        </span><span class="n">aggregate</span><span class="p">.</span><span class="na">markEventsAsCommitted</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">aggregate</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">aggregate</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">uncommittedEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aggregate</span><span class="p">.</span><span class="na">getUncommittedEvents</span><span class="p">();</span>
<span class="w">        </span><span class="n">eventStoreRepository</span><span class="p">.</span><span class="na">saveEvents</span><span class="p">(</span>
<span class="w">            </span><span class="n">aggregate</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span>
<span class="w">            </span><span class="n">uncommittedEvents</span><span class="p">,</span><span class="w"> </span>
<span class="w">            </span><span class="n">aggregate</span><span class="p">.</span><span class="na">getVersion</span><span class="p">()</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Publish events to message bus</span>
<span class="w">        </span><span class="n">eventPublisher</span><span class="p">.</span><span class="na">publish</span><span class="p">(</span><span class="n">uncommittedEvents</span><span class="p">);</span>

<span class="w">        </span><span class="n">aggregate</span><span class="p">.</span><span class="na">markEventsAsCommitted</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="saga-pattern-orchestration">Saga Pattern (Orchestration)</h4>
<p><strong>Intent</strong>: Manage distributed transactions across multiple services.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderSaga</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">SagaState</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">STARTED</span><span class="p">,</span><span class="w"> </span><span class="n">PAYMENT_PENDING</span><span class="p">,</span><span class="w"> </span><span class="n">INVENTORY_RESERVED</span><span class="p">,</span><span class="w"> </span>
<span class="w">        </span><span class="n">COMPLETED</span><span class="p">,</span><span class="w"> </span><span class="n">COMPENSATING</span><span class="p">,</span><span class="w"> </span><span class="n">FAILED</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Entity</span>
<span class="w">    </span><span class="nd">@Table</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;saga_instances&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SagaInstance</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nd">@Id</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">sagaId</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="n">orderId</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">SagaState</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sagaData</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">createdAt</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="n">Instant</span><span class="w"> </span><span class="n">updatedAt</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@SagaOrchestrationStart</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleOrderCreated</span><span class="p">(</span><span class="n">OrderCreatedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">sagaInstance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SagaInstance</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">(),</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="na">getAggregateId</span><span class="p">());</span>
<span class="w">        </span><span class="n">sagaInstance</span><span class="p">.</span><span class="na">setState</span><span class="p">(</span><span class="n">SagaState</span><span class="p">.</span><span class="na">STARTED</span><span class="p">);</span>
<span class="w">        </span><span class="n">sagaRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">sagaInstance</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Step 1: Reserve inventory</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ReserveInventoryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getAggregateId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getItems</span><span class="p">()</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@SagaOrchestrationHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleInventoryReserved</span><span class="p">(</span><span class="n">InventoryReservedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">saga</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sagaRepository</span><span class="p">.</span><span class="na">findByOrderId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">());</span>
<span class="w">        </span><span class="n">saga</span><span class="p">.</span><span class="na">setState</span><span class="p">(</span><span class="n">SagaState</span><span class="p">.</span><span class="na">INVENTORY_RESERVED</span><span class="p">);</span>
<span class="w">        </span><span class="n">sagaRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">saga</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Step 2: Process payment</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ProcessPaymentCommand</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">saga</span><span class="p">.</span><span class="na">getSagaData</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;paymentAmount&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@SagaOrchestrationHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handlePaymentProcessed</span><span class="p">(</span><span class="n">PaymentProcessedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">saga</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sagaRepository</span><span class="p">.</span><span class="na">findByOrderId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">());</span>
<span class="w">        </span><span class="n">saga</span><span class="p">.</span><span class="na">setState</span><span class="p">(</span><span class="n">SagaState</span><span class="p">.</span><span class="na">COMPLETED</span><span class="p">);</span>
<span class="w">        </span><span class="n">sagaRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">saga</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Step 3: Confirm order</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ConfirmOrderCommand</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">()));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Compensation handlers</span>
<span class="w">    </span><span class="nd">@SagaOrchestrationHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleInventoryReservationFailed</span><span class="p">(</span><span class="n">InventoryReservationFailedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">saga</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sagaRepository</span><span class="p">.</span><span class="na">findByOrderId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">());</span>
<span class="w">        </span><span class="n">saga</span><span class="p">.</span><span class="na">setState</span><span class="p">(</span><span class="n">SagaState</span><span class="p">.</span><span class="na">FAILED</span><span class="p">);</span>
<span class="w">        </span><span class="n">sagaRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">saga</span><span class="p">);</span>

<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">CancelOrderCommand</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">()));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@SagaOrchestrationHandler</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handlePaymentFailed</span><span class="p">(</span><span class="n">PaymentFailedEvent</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">saga</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sagaRepository</span><span class="p">.</span><span class="na">findByOrderId</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">());</span>
<span class="w">        </span><span class="n">saga</span><span class="p">.</span><span class="na">setState</span><span class="p">(</span><span class="n">SagaState</span><span class="p">.</span><span class="na">COMPENSATING</span><span class="p">);</span>
<span class="w">        </span><span class="n">sagaRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">saga</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Compensate: Release inventory</span>
<span class="w">        </span><span class="n">commandGateway</span><span class="p">.</span><span class="na">send</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ReleaseInventoryCommand</span><span class="p">(</span>
<span class="w">            </span><span class="n">event</span><span class="p">.</span><span class="na">getOrderId</span><span class="p">(),</span>
<span class="w">            </span><span class="n">saga</span><span class="p">.</span><span class="na">getSagaData</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;reservedItems&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="4-integration-patterns">4. Integration Patterns</h3>
<h4 id="backend-for-frontend-bff">Backend for Frontend (BFF)</h4>
<p><strong>Intent</strong>: Create service layers tailored to specific frontend needs.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Mobile BFF</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/mobile/api&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MobileBffController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/dashboard&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MobileDashboardResponse</span><span class="w"> </span><span class="nf">getDashboard</span><span class="p">(</span><span class="nd">@AuthenticationPrincipal</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Optimized for mobile - minimal data</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderService</span><span class="p">.</span><span class="na">getRecentOrders</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">recommendations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recommendationService</span><span class="p">.</span><span class="na">getTopRecommendations</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MobileDashboardResponse</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">recentOrders</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">toMobileOrderSummary</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">toList</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">MobileOrderSummary</span><span class="w"> </span><span class="nf">toMobileOrderSummary</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MobileOrderSummary</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">orderId</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getStatus</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">totalAmount</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getTotalAmount</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">itemCount</span><span class="p">(</span><span class="n">order</span><span class="p">.</span><span class="na">getItems</span><span class="p">().</span><span class="na">size</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Web BFF</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&quot;/web/api&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">WebBffController</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&quot;/dashboard&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">WebDashboardResponse</span><span class="w"> </span><span class="nf">getDashboard</span><span class="p">(</span><span class="nd">@AuthenticationPrincipal</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Rich data for web interface</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderService</span><span class="p">.</span><span class="na">getRecentOrdersWithDetails</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">analytics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analyticsService</span><span class="p">.</span><span class="na">getUserAnalytics</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">recommendations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recommendationService</span><span class="p">.</span><span class="na">getPersonalizedRecommendations</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">WebDashboardResponse</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">orders</span><span class="p">(</span><span class="n">orders</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">analytics</span><span class="p">(</span><span class="n">analytics</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">recommendations</span><span class="p">(</span><span class="n">recommendations</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="anti-corruption-layer-acl">Anti-Corruption Layer (ACL)</h4>
<p><strong>Intent</strong>: Protect domain model from external system dependencies.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Legacy payment gateway adapter</span>
<span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">LegacyPaymentGatewayAdapter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">PaymentGateway</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LegacyPaymentClient</span><span class="w"> </span><span class="n">legacyClient</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PaymentResult</span><span class="w"> </span><span class="nf">processPayment</span><span class="p">(</span><span class="n">PaymentRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Translate domain model to legacy format</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">legacyRequest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LegacyPaymentRequest</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">amount</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getAmount</span><span class="p">().</span><span class="na">multiply</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">)))</span><span class="w"> </span><span class="c1">// Convert to cents</span>
<span class="w">                </span><span class="p">.</span><span class="na">currency</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getCurrency</span><span class="p">().</span><span class="na">getCurrencyCode</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">cardNumber</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getCardDetails</span><span class="p">().</span><span class="na">getNumber</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">expiryMonth</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%02d&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getCardDetails</span><span class="p">().</span><span class="na">getExpiryMonth</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">expiryYear</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getCardDetails</span><span class="p">().</span><span class="na">getExpiryYear</span><span class="p">()))</span>
<span class="w">                </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">legacyResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">legacyClient</span><span class="p">.</span><span class="na">chargeCard</span><span class="p">(</span><span class="n">legacyRequest</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Translate response back to domain model</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">PaymentResult</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">paymentId</span><span class="p">(</span><span class="n">UUID</span><span class="p">.</span><span class="na">fromString</span><span class="p">(</span><span class="n">legacyResponse</span><span class="p">.</span><span class="na">getTransactionId</span><span class="p">()))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">status</span><span class="p">(</span><span class="n">mapLegacyStatus</span><span class="p">(</span><span class="n">legacyResponse</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">amount</span><span class="p">(</span><span class="n">legacyResponse</span><span class="p">.</span><span class="na">getChargedAmount</span><span class="p">().</span><span class="na">divide</span><span class="p">(</span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="mi">100</span><span class="p">)))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">processedAt</span><span class="p">(</span><span class="n">Instant</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">legacyResponse</span><span class="p">.</span><span class="na">getTimestamp</span><span class="p">()))</span>
<span class="w">                    </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">LegacyPaymentException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PaymentProcessingException</span><span class="p">(</span><span class="s">&quot;Payment failed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PaymentStatus</span><span class="w"> </span><span class="nf">mapLegacyStatus</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">legacyStatus</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">legacyStatus</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;SUCCESS&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PaymentStatus</span><span class="p">.</span><span class="na">COMPLETED</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;PENDING&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PaymentStatus</span><span class="p">.</span><span class="na">PROCESSING</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;DECLINED&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PaymentStatus</span><span class="p">.</span><span class="na">DECLINED</span><span class="p">;</span>
<span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="s">&quot;ERROR&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">PaymentStatus</span><span class="p">.</span><span class="na">FAILED</span><span class="p">;</span>
<span class="w">            </span><span class="k">default</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Unknown legacy status: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">legacyStatus</span><span class="p">);</span>
<span class="w">        </span><span class="p">};</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="strangler-fig-pattern">Strangler Fig Pattern</h4>
<p><strong>Intent</strong>: Gradually replace legacy systems by intercepting and redirecting calls.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderServiceStranglerFig</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">LegacyOrderService</span><span class="w"> </span><span class="n">legacyOrderService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ModernOrderService</span><span class="w"> </span><span class="n">modernOrderService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">FeatureToggleService</span><span class="w"> </span><span class="n">featureToggleService</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="nf">getOrder</span><span class="p">(</span><span class="n">UUID</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Determine which implementation to use</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shouldUseLegacyService</span><span class="p">(</span><span class="n">orderId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="n">legacyOrder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">legacyOrderService</span><span class="p">.</span><span class="na">getOrder</span><span class="p">(</span><span class="n">orderId</span><span class="p">.</span><span class="na">toString</span><span class="p">());</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">adaptLegacyOrder</span><span class="p">(</span><span class="n">legacyOrder</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">modernOrderService</span><span class="p">.</span><span class="na">getOrder</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Order</span><span class="w"> </span><span class="nf">createOrder</span><span class="p">(</span><span class="n">CreateOrderRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// New orders always use modern service</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modernOrderService</span><span class="p">.</span><span class="na">createOrder</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Optionally sync to legacy system for compatibility</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">featureToggleService</span><span class="p">.</span><span class="na">isEnabled</span><span class="p">(</span><span class="s">&quot;sync-to-legacy&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">legacyOrderService</span><span class="p">.</span><span class="na">syncOrder</span><span class="p">(</span><span class="n">adaptModernOrder</span><span class="p">(</span><span class="n">order</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">order</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">shouldUseLegacyService</span><span class="p">(</span><span class="n">UUID</span><span class="w"> </span><span class="n">orderId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Check if order exists in modern system</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">modernOrderService</span><span class="p">.</span><span class="na">exists</span><span class="p">(</span><span class="n">orderId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Check feature toggle for gradual migration</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">migrationPercentage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">featureToggleService</span><span class="p">.</span><span class="na">getPercentage</span><span class="p">(</span><span class="s">&quot;modern-order-service&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">orderId</span><span class="p">.</span><span class="na">hashCode</span><span class="p">()</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">hash</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">migrationPercentage</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="5-resilience-patterns">5. Resilience Patterns</h3>
<h4 id="bulkhead-pattern">Bulkhead Pattern</h4>
<p><strong>Intent</strong>: Isolate resources to prevent cascading failures.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Configuration</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">BulkheadConfiguration</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;orderProcessing&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Executor</span><span class="w"> </span><span class="nf">orderProcessingExecutor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolTaskExecutor</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
<span class="w">            </span><span class="n">setCorePoolSize</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">            </span><span class="n">setMaxPoolSize</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="w">            </span><span class="n">setQueueCapacity</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
<span class="w">            </span><span class="n">setThreadNamePrefix</span><span class="p">(</span><span class="s">&quot;order-processing-&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">setRejectedExecutionHandler</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">CallerRunsPolicy</span><span class="p">());</span>
<span class="w">        </span><span class="p">}};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;notifications&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Executor</span><span class="w"> </span><span class="nf">notificationExecutor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolTaskExecutor</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
<span class="w">            </span><span class="n">setCorePoolSize</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="w">            </span><span class="n">setMaxPoolSize</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="w">            </span><span class="n">setQueueCapacity</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
<span class="w">            </span><span class="n">setThreadNamePrefix</span><span class="p">(</span><span class="s">&quot;notifications-&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">setRejectedExecutionHandler</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">DiscardOldestPolicy</span><span class="p">());</span>
<span class="w">        </span><span class="p">}};</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;analytics&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Executor</span><span class="w"> </span><span class="nf">analyticsExecutor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolTaskExecutor</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
<span class="w">            </span><span class="n">setCorePoolSize</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">            </span><span class="n">setMaxPoolSize</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="w">            </span><span class="n">setQueueCapacity</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="w">            </span><span class="n">setThreadNamePrefix</span><span class="p">(</span><span class="s">&quot;analytics-&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">setRejectedExecutionHandler</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ThreadPoolExecutor</span><span class="p">.</span><span class="na">DiscardPolicy</span><span class="p">());</span>
<span class="w">        </span><span class="p">}};</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Async</span><span class="p">(</span><span class="s">&quot;orderProcessing&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Order</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">processOrder</span><span class="p">(</span><span class="n">CreateOrderRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Critical order processing in dedicated thread pool</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">CompletableFuture</span><span class="p">.</span><span class="na">completedFuture</span><span class="p">(</span><span class="n">createOrder</span><span class="p">(</span><span class="n">request</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Async</span><span class="p">(</span><span class="s">&quot;notifications&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendOrderNotification</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Non-critical notifications in separate thread pool</span>
<span class="w">        </span><span class="n">notificationService</span><span class="p">.</span><span class="na">sendOrderConfirmation</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Async</span><span class="p">(</span><span class="s">&quot;analytics&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordOrderAnalytics</span><span class="p">(</span><span class="n">Order</span><span class="w"> </span><span class="n">order</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Analytics processing in lowest priority thread pool</span>
<span class="w">        </span><span class="n">analyticsService</span><span class="p">.</span><span class="na">recordOrderEvent</span><span class="p">(</span><span class="n">order</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="timeout-pattern">Timeout Pattern</h4>
<p><strong>Intent</strong>: Prevent resource exhaustion by setting maximum wait times.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TimeoutConfiguration</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="nf">restTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">factory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HttpComponentsClientHttpRequestFactory</span><span class="p">();</span>
<span class="w">        </span><span class="n">factory</span><span class="p">.</span><span class="na">setConnectTimeout</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span><span class="w">     </span><span class="c1">// 5 seconds</span>
<span class="w">        </span><span class="n">factory</span><span class="p">.</span><span class="na">setReadTimeout</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span><span class="w">       </span><span class="c1">// 10 seconds</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RestTemplate</span><span class="p">(</span><span class="n">factory</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">redisTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">setConnectionFactory</span><span class="p">(</span><span class="n">jedisConnectionFactory</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Set command timeout</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">jedisConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JedisPoolConfig</span><span class="p">();</span>
<span class="w">        </span><span class="n">jedisConfig</span><span class="p">.</span><span class="na">setMaxWaitMillis</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span><span class="w">  </span><span class="c1">// 2 seconds</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">template</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Service with timeout handling</span>
<span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ExternalApiService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RestTemplate</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Retryable</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">TimeoutException</span><span class="p">.</span><span class="na">class</span><span class="p">},</span><span class="w"> </span><span class="n">maxAttempts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ApiResponse</span><span class="w"> </span><span class="nf">callExternalApi</span><span class="p">(</span><span class="n">ApiRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">restTemplate</span><span class="p">.</span><span class="na">postForObject</span><span class="p">(</span><span class="s">&quot;/api/external&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">ApiResponse</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ResourceAccessException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getCause</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">SocketTimeoutException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TimeoutException</span><span class="p">(</span><span class="s">&quot;External API call timed out&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Recover</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">ApiResponse</span><span class="w"> </span><span class="nf">recoverFromTimeout</span><span class="p">(</span><span class="n">TimeoutException</span><span class="w"> </span><span class="n">ex</span><span class="p">,</span><span class="w"> </span><span class="n">ApiRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;External API call failed after retries, using fallback response&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ApiResponse</span><span class="p">.</span><span class="na">fallback</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="retry-pattern-with-backoff">Retry Pattern with Backoff</h4>
<p><strong>Intent</strong>: Handle transient failures with intelligent retry strategies.</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RetryConfiguration</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Linear backoff</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;linearRetry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RetryTemplate</span><span class="w"> </span><span class="nf">linearRetryTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RetryTemplate</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">maxAttempts</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">fixedBackoff</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="w"> </span><span class="c1">// 1 second between retries</span>
<span class="w">            </span><span class="p">.</span><span class="na">retryOn</span><span class="p">(</span><span class="n">TransientException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Exponential backoff</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;exponentialRetry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RetryTemplate</span><span class="w"> </span><span class="nf">exponentialRetryTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">RetryTemplate</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="na">maxAttempts</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">exponentialBackoff</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">10000</span><span class="p">)</span><span class="w"> </span><span class="c1">// 1s, 2s, 4s, 8s, 10s</span>
<span class="w">            </span><span class="p">.</span><span class="na">retryOn</span><span class="p">(</span><span class="n">TransientException</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Exponential backoff with jitter</span>
<span class="w">    </span><span class="nd">@Bean</span>
<span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jitterRetry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RetryTemplate</span><span class="w"> </span><span class="nf">jitterRetryTemplate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">backoffPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ExponentialBackOffPolicy</span><span class="p">();</span>
<span class="w">        </span><span class="n">backoffPolicy</span><span class="p">.</span><span class="na">setInitialInterval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="w">        </span><span class="n">backoffPolicy</span><span class="p">.</span><span class="na">setMultiplier</span><span class="p">(</span><span class="mf">2.0</span><span class="p">);</span>
<span class="w">        </span><span class="n">backoffPolicy</span><span class="p">.</span><span class="na">setMaxInterval</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">retryPolicy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleRetryPolicy</span><span class="p">();</span>
<span class="w">        </span><span class="n">retryPolicy</span><span class="p">.</span><span class="na">setMaxAttempts</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RetryTemplate</span><span class="p">();</span>
<span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">setBackOffPolicy</span><span class="p">(</span><span class="n">backoffPolicy</span><span class="p">);</span>
<span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">setRetryPolicy</span><span class="p">(</span><span class="n">retryPolicy</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Add jitter</span>
<span class="w">        </span><span class="n">template</span><span class="p">.</span><span class="na">setBackOffPolicy</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ExponentialRandomBackOffPolicy</span><span class="p">()</span><span class="w"> </span><span class="p">{{</span>
<span class="w">            </span><span class="n">setInitialInterval</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="w">            </span><span class="n">setMultiplier</span><span class="p">(</span><span class="mf">2.0</span><span class="p">);</span>
<span class="w">            </span><span class="n">setMaxInterval</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
<span class="w">        </span><span class="p">}});</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">template</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="nd">@Service</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PaymentService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Autowired</span>
<span class="w">    </span><span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;jitterRetry&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RetryTemplate</span><span class="w"> </span><span class="n">retryTemplate</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">PaymentResult</span><span class="w"> </span><span class="nf">processPayment</span><span class="p">(</span><span class="n">PaymentRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">retryTemplate</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="n">context</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Processing payment, attempt {}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getRetryCount</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">paymentGateway</span><span class="p">.</span><span class="na">processPayment</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">PaymentGatewayException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">isRetryable</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TransientException</span><span class="p">(</span><span class="s">&quot;Payment gateway temporarily unavailable&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PermanentException</span><span class="p">(</span><span class="s">&quot;Payment failed permanently&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="implementation-roadmap">Implementation Roadmap</h2>
<h3 id="week-1-2-foundation">Week 1-2: Foundation</h3>
<ul>
<li>Service decomposition (logical)</li>
<li>Basic API Gateway</li>
<li>Shared libraries setup</li>
<li>Simple retry patterns</li>
</ul>
<h3 id="week-3-4-communication">Week 3-4: Communication</h3>
<ul>
<li>Service discovery</li>
<li>Circuit breaker</li>
<li>Load balancing</li>
<li>Health checks</li>
</ul>
<h3 id="week-5-6-data-patterns">Week 5-6: Data Patterns</h3>
<ul>
<li>CQRS implementation</li>
<li>Event store setup</li>
<li>Basic projections</li>
<li>Command/query separation</li>
</ul>
<h3 id="week-7-8-advanced-data">Week 7-8: Advanced Data</h3>
<ul>
<li>Event sourcing</li>
<li>Saga orchestration</li>
<li>Compensation patterns</li>
<li>Event replay</li>
</ul>
<h3 id="week-9-10-integration">Week 9-10: Integration</h3>
<ul>
<li>BFF implementation</li>
<li>Anti-corruption layers</li>
<li>Legacy system integration</li>
<li>API versioning</li>
</ul>
<h3 id="week-11-12-resilience">Week 11-12: Resilience</h3>
<ul>
<li>Bulkhead pattern</li>
<li>Timeout configuration</li>
<li>Advanced retry strategies</li>
<li>Failure injection testing</li>
</ul>
<h2 id="testing-strategy">Testing Strategy</h2>
<h3 id="pattern-specific-testing">Pattern-Specific Testing</h3>
<div class="highlight"><pre><span></span><code><span class="c1">// Test CQRS command/query separation</span>
<span class="nd">@Test</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testCqrsSeparation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CreateOrderCommand</span><span class="p">(</span><span class="n">customerId</span><span class="p">,</span><span class="w"> </span><span class="n">items</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// When</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">orderId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commandHandler</span><span class="p">.</span><span class="na">handle</span><span class="p">(</span><span class="n">command</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Then - verify command side</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">aggregate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aggregateRepository</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>
<span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">aggregate</span><span class="p">.</span><span class="na">getStatus</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">OrderStatus</span><span class="p">.</span><span class="na">PENDING</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// And verify query side (eventually consistent)</span>
<span class="w">    </span><span class="n">await</span><span class="p">().</span><span class="na">atMost</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">SECONDS</span><span class="p">).</span><span class="na">until</span><span class="p">(()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">orderView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">queryService</span><span class="p">.</span><span class="na">getOrderView</span><span class="p">(</span><span class="n">orderId</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orderView</span><span class="p">.</span><span class="na">getStatus</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;PENDING&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// Test circuit breaker</span>
<span class="nd">@Test</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testCircuitBreakerTrip</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Given - service is failing</span>
<span class="w">    </span><span class="n">when</span><span class="p">(</span><span class="n">externalService</span><span class="p">.</span><span class="na">call</span><span class="p">()).</span><span class="na">thenThrow</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ServiceException</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// When - multiple calls</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">serviceWithCircuitBreaker</span><span class="p">.</span><span class="na">callExternal</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Expected</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Then - circuit breaker should be open</span>
<span class="w">    </span><span class="n">assertThat</span><span class="p">(</span><span class="n">circuitBreaker</span><span class="p">.</span><span class="na">getState</span><span class="p">()).</span><span class="na">isEqualTo</span><span class="p">(</span><span class="n">CircuitBreakerState</span><span class="p">.</span><span class="na">OPEN</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// And subsequent calls should fail fast</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">serviceWithCircuitBreaker</span><span class="p">.</span><span class="na">callExternal</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">;</span>
<span class="w">        </span><span class="n">assertThat</span><span class="p">(</span><span class="n">duration</span><span class="p">).</span><span class="na">isLessThan</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span><span class="w"> </span><span class="c1">// Failed fast</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="monitoring-and-observability">Monitoring and Observability</h2>
<h3 id="pattern-specific-metrics">Pattern-Specific Metrics</h3>
<div class="highlight"><pre><span></span><code><span class="nd">@Component</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MicroservicesMetrics</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">MeterRegistry</span><span class="w"> </span><span class="n">meterRegistry</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Circuit breaker metrics</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordCircuitBreakerState</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">circuitName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Gauge</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;circuit_breaker.state&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&quot;circuit&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">circuitName</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&quot;state&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">meterRegistry</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;OPEN&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Saga metrics</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordSagaCompletion</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">sagaType</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">outcome</span><span class="p">,</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Timer</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;saga.duration&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&quot;saga_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sagaType</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&quot;outcome&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">outcome</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">meterRegistry</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">record</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// CQRS metrics</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordCommandProcessing</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">commandType</span><span class="p">,</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Timer</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;command.processing.duration&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&quot;command_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">commandType</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">meterRegistry</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">record</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">recordQueryExecution</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">queryType</span><span class="p">,</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="n">duration</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Timer</span><span class="p">.</span><span class="na">builder</span><span class="p">(</span><span class="s">&quot;query.execution.duration&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">tag</span><span class="p">(</span><span class="s">&quot;query_type&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">queryType</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="n">meterRegistry</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="na">record</span><span class="p">(</span><span class="n">duration</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<p>This comprehensive guide provides a structured approach to implementing microservices patterns in the BitVelocity platform, ensuring gradual complexity introduction while maintaining production-ready standards.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>